{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "additionalProperties": false,
  "description": "Image Builder new blueprint schema.\n\nTHIS IS WORK IN PROGRESS",
  "properties": {
    "accounts": {
      "additionalProperties": false,
      "properties": {
        "groups": {
          "description": "Operating system group accounts to be created on the image.",
          "items": {
            "additionalProperties": false,
            "properties": {
              "gid": {
                "description": "The group ID (GID) of the group.",
                "minimum": 1,
                "type": "integer"
              },
              "name": {
                "description": "Group name. Accepted characters: lowercase letters, digits, underscores, dollars, and hyphens. Name must not start with a hyphen. Maximum length is 256 characters. The validation pattern is a relaxed version of https://github.com/shadow-maint/shadow/blob/master/lib/chkname.c",
                "maxLength": 256,
                "pattern": "^[a-zA-Z0-9_.][a-zA-Z0-9_.$-]*$",
                "type": "string"
              }
            },
            "required": [
              "name"
            ],
            "type": "object"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "users": {
          "description": "Operating system user accounts to be created on the image.",
          "items": {
            "additionalProperties": false,
            "properties": {
              "description": {
                "description": "A longer description of the account.",
                "maxLength": 4096,
                "type": "string"
              },
              "expires": {
                "description": "Date type which accepts date (YYYY-MM-DD) or date-time (RFC3339) format and only marshals into date format. This is needed for JSON/YAML compatibility since YAML automatically converts strings which look like dates into time.Time.",
                "pattern": "^\\d{4}-\\d{2}-\\d{2}T?[0-9:Z-]*",
                "type": "string"
              },
              "gid": {
                "description": "The primary group ID (GID) of the user. Value of zero (or ommited value) means that the next available UID will be assigned.",
                "minimum": 1,
                "type": "integer"
              },
              "groups": {
                "description": "Additional groups that the user should be a member of.",
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              "home": {
                "description": "The home directory of the user.",
                "type": "string"
              },
              "name": {
                "description": "Account name. Accepted characters: lowercase letters, digits, underscores, dollars, and hyphens. Name must not start with a hyphen. Maximum length is 256 characters. The validation pattern is a relaxed version of https://github.com/shadow-maint/shadow/blob/master/lib/chkname.c",
                "maxLength": 256,
                "pattern": "^[a-zA-Z0-9_.][a-zA-Z0-9_.$-]*$",
                "type": "string"
              },
              "password": {
                "description": "Password either in plain text or encrypted form. If the password is not provided, the account will be locked and the user will not be able to log in with a password. The password can be encrypted using the crypt(3) function. The format of the encrypted password is $id$salt$hashed, where $id is the algorithm used (1, 5, 6, or 2a).",
                "type": "string"
              },
              "shell": {
                "description": "The shell of the user.",
                "type": "string"
              },
              "ssh_keys": {
                "description": "SSH keys to be added to the account's authorized_keys file.",
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              "uid": {
                "description": "The user ID (UID) of the user. Value of zero (or ommited value) means that the next available UID will be assigned.",
                "minimum": 1,
                "type": "integer"
              }
            },
            "required": [
              "name"
            ],
            "type": "object"
          },
          "type": [
            "array",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "cacerts": {
      "description": "The CA certificates to be added to the image. The certificates are added to the system-wide CA trust store. The certificates are added to the /etc/pki/ca-trust/source/anchors/ directory and the update-ca-trust command is run to update the system-wide CA trust store.",
      "items": {
        "additionalProperties": false,
        "properties": {
          "cert": {
            "description": "The PEM-encoded certificate.",
            "type": "string"
          }
        },
        "required": [
          "cert"
        ],
        "type": "object"
      },
      "type": [
        "array",
        "null"
      ]
    },
    "containers": {
      "description": "Containers to be pulled during the image build and stored in the image at the default local container storage location that is appropriate for the image type, so that all supported container tools like podman and cri-o will be able to work with it. The embedded containers are not started, to do so you can create systemd unit files or quadlets with the files customization.",
      "items": {
        "additionalProperties": false,
        "properties": {
          "local_storage": {
            "default": false,
            "description": "Whether to pull the container image from the host's local-storage.",
            "type": "boolean"
          },
          "name": {
            "description": "Container name is an optional string to set the name under which the container image will be saved in the image. If not specified name falls back to the same value as source.",
            "type": "string"
          },
          "source": {
            "description": "Container image URL is a reference to a container image at a registry.",
            "type": "string"
          },
          "tls_verify": {
            "type": [
              "boolean",
              "null"
            ]
          }
        },
        "required": [
          "source",
          "name"
        ],
        "type": "object"
      },
      "type": [
        "array",
        "null"
      ]
    },
    "description": {
      "description": "The description attribute is a string that can be a longer description of the blueprint and is only used for display purposes.",
      "type": "string"
    },
    "dnf": {
      "additionalProperties": false,
      "properties": {
        "groups": {
          "description": "Groups to install, must match exactly. Groups describes groups of packages to be installed into the image. Package groups are defined in the repository metadata. Each group has a descriptive name used primarily for display in user interfaces and an ID more commonly used in kickstart files. Here, the ID is the expected way of listing a group. Groups have three different ways of categorizing their packages: mandatory, default, and optional. For the purposes of blueprints, only mandatory and default packages will be installed. There is no mechanism for selecting optional packages.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "import_keys": {
          "description": "Additional file paths to the GPG keys to import. The files must be present in the image. Does not support importing from URLs.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "modules": {
          "description": "Modules to enable or disable",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "packages": {
          "description": "Packages to install. Package name or NVRA is accepted as long as DNF can resolve it. Examples: vim-enhanced, vim-enhanced-9.1.866-1 or vim-enhanced-9.1.866-1.fc41.x86_64. The packages can also be specified as @group_name to install all packages in the group.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "repositories": {
          "description": "Third-party repositories are supported by the blueprint customizations.\n\nAll fields reflect configuration values of dnf, see man dnf.conf(5) for more information.",
          "items": {
            "additionalProperties": false,
            "oneOf": [
              {
                "required": [
                  "base_urls"
                ],
                "title": "dnf_repo_base_urls"
              },
              {
                "required": [
                  "mirror_list"
                ],
                "title": "dnf_repo_mirrorlist"
              },
              {
                "required": [
                  "metalink"
                ],
                "title": "dnf_repo_metalink"
              }
            ],
            "properties": {
              "base_urls": {
                "description": "Base URLs for the repository.",
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              "filename": {
                "description": "Repository filename to use for the repository configuration file. If not provided, the ID is used. Filename must be provided without the .repo extension.",
                "maxLength": 256,
                "pattern": "^[a-zA-Z0-9_-]+$",
                "type": "string"
              },
              "gpg_check": {
                "default": true,
                "description": "Enable GPG check for the repository.",
                "type": "boolean"
              },
              "gpg_check_repo": {
                "default": true,
                "description": "Enable GPG check for the repository metadata.",
                "type": "boolean"
              },
              "gpg_keys": {
                "description": "GPG keys for the repository.\n\nThe blueprint accepts both inline GPG keys and GPG key urls. If an inline GPG key is provided it will be saved to the /etc/pki/rpm-gpg directory and will be referenced accordingly in the repository configuration. GPG keys are not imported to the RPM database and will only be imported when first installing a package from the third-party repository.",
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              "id": {
                "description": "Repository ID. Required.",
                "maxLength": 256,
                "pattern": "^[a-zA-Z0-9_-]+$",
                "type": "string"
              },
              "metalink": {
                "description": "Metalink for the repository.",
                "type": "string"
              },
              "mirror_list": {
                "description": "Mirror list for the repository.",
                "type": "string"
              },
              "module_hotfixes": {
                "default": false,
                "description": "Enable module hotfixes for the repository.\n\nAdds module_hotfixes flag to all repo types so it can be used during osbuild. This enables users to disable modularity filtering on specific repositories.",
                "type": "boolean"
              },
              "name": {
                "description": "Repository name.",
                "type": "string"
              },
              "priority": {
                "default": 99,
                "description": "Repository priority.",
                "type": "integer"
              },
              "ssl_verify": {
                "default": true,
                "description": "Enable SSL verification for the repository.",
                "type": "boolean"
              },
              "usage": {
                "additionalProperties": false,
                "properties": {
                  "configure": {
                    "default": true,
                    "description": "Configure the repository for dnf.\n\nA repository will be saved to the /etc/yum.repos.d directory in an image. An optional filename argument can be set, otherwise the repository will be saved using the the repository ID, i.e. /etc/yum.repos.d/<repo-id>.repo.",
                    "type": "boolean"
                  },
                  "install": {
                    "default": false,
                    "description": "Use the repository for image build.\n\nWhen this flag is set, it is possible to install third-party packages during the image build.",
                    "type": "boolean"
                  }
                },
                "type": "object"
              }
            },
            "required": [
              "id"
            ],
            "type": "object"
          },
          "type": [
            "array",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "fips": {
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "description": "Enables the system FIPS mode (disabled by default). Currently only edge-raw-image, edge-installer, edge-simplified-installer, edge-ami and edge-vsphere images support this customization.",
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "fsnodes": {
      "description": "File system nodes details.\n\nYou can use the customization to create new files or to replace existing ones, if not restricted by the policy specified below. If the target path is an existing symlink to another file, the symlink will be replaced by the custom file.\n\nPlease note that the parent directory of a specified file must exist. If it does not exist, the image build will fail. One can ensure that the parent directory exists by specifying \"ensure_parents\".\n\nIn addition, the following files are not allowed to be created or replaced by policy: /etc/fstab, /etc/shadow, /etc/passwd and /etc/group.\n\nUsing the files customization comes with a high chance of creating an image that doesn't boot. Use this feature only if you know what you are doing. Although the files customization can be used to configure parts of the OS which can also be configured by other blueprint customizations, this use is discouraged. If possible, users should always default to using the specialized blueprint customizations. Note that if you combine the files customizations with other customizations, the other customizations may not work as expected or may be overridden by the files customizations.\n\nYou can create custom directories as well. The existence of a specified directory is handled gracefully only if no explicit mode, user or group is specified. If any of these customizations are specified and the directory already exists in the image, the image build will fail. The intention is to prevent changing the ownership or permissions of existing directories.",
      "items": {
        "additionalProperties": false,
        "allOf": [
          {
            "anyOf": [
              {
                "not": {
                  "properties": {
                    "type": {
                      "enum": [
                        "dir"
                      ]
                    }
                  },
                  "required": [
                    "type"
                  ]
                }
              },
              {
                "not": {
                  "required": [
                    "contents"
                  ]
                }
              }
            ]
          }
        ],
        "properties": {
          "contents": {
            "additionalProperties": false,
            "properties": {
              "base64": {
                "description": "Base64-encoded file contents. Useful for binaries.",
                "type": "string"
              },
              "text": {
                "description": "Plain text file contents.",
                "type": "string"
              }
            },
            "type": "object"
          },
          "ensure_parents": {
            "default": false,
            "description": "EnsureParents is a boolean that determines if the parent directories should be created if they do not exist.",
            "type": "boolean"
          },
          "group": {
            "default": "root",
            "description": "Group is the file system node group. Defaults to root.",
            "type": "string"
          },
          "mode": {
            "description": "Mode is the file system node permissions. Defaults to 0644 for files and 0755 for directories.",
            "type": "integer"
          },
          "path": {
            "description": "Path is the absolute path to the file or directory.",
            "pattern": "^/",
            "type": "string"
          },
          "state": {
            "default": "present",
            "description": "State is the state of the file system node, one of: present, absent.",
            "enum": [
              "present",
              "absent"
            ]
          },
          "type": {
            "default": "file",
            "description": "Type is the type of the file system node, one of: file, dir.",
            "enum": [
              "file",
              "dir"
            ]
          },
          "user": {
            "default": "root",
            "description": "User is the file system node owner. Defaults to root.",
            "type": "string"
          }
        },
        "required": [
          "path"
        ],
        "type": "object"
      },
      "type": [
        "array",
        "null"
      ]
    },
    "hostname": {
      "description": "Hostname is an optional string that can be used to configure the hostname of the final image.",
      "type": "string"
    },
    "ignition": {
      "additionalProperties": false,
      "oneOf": [
        {
          "required": [
            "firstboot_url"
          ],
          "title": "ignition_url"
        },
        {
          "required": [
            "embedded"
          ],
          "title": "ignition_embedded"
        }
      ],
      "properties": {
        "embedded": {
          "additionalProperties": false,
          "oneOf": [
            {
              "required": [
                "text"
              ],
              "title": "ignition_text"
            },
            {
              "required": [
                "base64"
              ],
              "title": "ignition_base64"
            }
          ],
          "properties": {
            "base64": {
              "description": "Ignition data formatted in base64.",
              "type": "string"
            },
            "text": {
              "description": "Ignition data formatted in plain text.",
              "type": "string"
            }
          },
          "type": "object"
        },
        "firstboot_url": {
          "description": "The URL to the Ignition configuration to be used by Ignition. This configuration is a URL to a remote Ignition configuration. The firstboot_url is used if the embedded configuration is not specified.\n\nCannot be used with embedded_base64 or embedded_text.",
          "type": "string"
        }
      },
      "type": "object"
    },
    "installer": {
      "additionalProperties": false,
      "properties": {
        "anaconda": {
          "additionalProperties": false,
          "properties": {
            "disabled_modules": {
              "items": {
                "enum": [
                  "org.fedoraproject.Anaconda.Modules.Localization",
                  "org.fedoraproject.Anaconda.Modules.Network",
                  "org.fedoraproject.Anaconda.Modules.Payloads",
                  "org.fedoraproject.Anaconda.Modules.Runtime",
                  "org.fedoraproject.Anaconda.Modules.Security",
                  "org.fedoraproject.Anaconda.Modules.Services",
                  "org.fedoraproject.Anaconda.Modules.Storage",
                  "org.fedoraproject.Anaconda.Modules.Subscription",
                  "org.fedoraproject.Anaconda.Modules.Timezone",
                  "org.fedoraproject.Anaconda.Modules.User"
                ]
              },
              "type": [
                "array",
                "null"
              ]
            },
            "enabled_modules": {
              "items": {
                "enum": [
                  "org.fedoraproject.Anaconda.Modules.Localization",
                  "org.fedoraproject.Anaconda.Modules.Network",
                  "org.fedoraproject.Anaconda.Modules.Payloads",
                  "org.fedoraproject.Anaconda.Modules.Runtime",
                  "org.fedoraproject.Anaconda.Modules.Security",
                  "org.fedoraproject.Anaconda.Modules.Services",
                  "org.fedoraproject.Anaconda.Modules.Storage",
                  "org.fedoraproject.Anaconda.Modules.Subscription",
                  "org.fedoraproject.Anaconda.Modules.Timezone",
                  "org.fedoraproject.Anaconda.Modules.User"
                ]
              },
              "type": [
                "array",
                "null"
              ]
            },
            "kickstart": {
              "additionalProperties": false,
              "oneOf": [
                {
                  "required": [
                    "text"
                  ],
                  "title": "kickstart_text"
                },
                {
                  "required": [
                    "base64"
                  ],
                  "title": "kickstart_base64"
                }
              ],
              "properties": {
                "base64": {
                  "description": "Kickstart file formatted in base64.",
                  "type": "string"
                },
                "text": {
                  "description": "Kickstart file formatted in plain text.",
                  "type": "string"
                }
              },
              "type": "object"
            },
            "sudo_nopasswd": {
              "description": "Sudo users with NOPASSWD option. Adds a snippet to the kickstart file that, after installation, will create drop-in files in /etc/sudoers.d to allow the specified users and groups to run sudo without a password (groups must be prefixed with %).",
              "items": {
                "maxLength": 256,
                "pattern": "^[%a-zA-Z0-9_.][a-zA-Z0-9_.$-]*$",
                "type": "string"
              },
              "type": "array"
            },
            "unattended": {
              "description": "Unattended installation Anaconda flag. When not set, Anaconda installer will ask for user input.",
              "type": "boolean"
            }
          },
          "type": "object"
        },
        "coreos": {
          "additionalProperties": false,
          "properties": {
            "installation_device": {
              "description": "Installation device for iot/edge simplified installer image types.",
              "type": "string"
            }
          },
          "type": "object"
        }
      },
      "type": "object"
    },
    "kernel": {
      "additionalProperties": false,
      "properties": {
        "cmdline_append": {
          "description": "An optional string to append arguments to the bootloader kernel command line. The list will be concatenated with spaces.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "package": {
          "description": "Kernel DNF package name to replace the standard kernel with.",
          "type": "string"
        }
      },
      "type": "object"
    },
    "locale": {
      "additionalProperties": false,
      "properties": {
        "keyboards": {
          "default": [
            "us"
          ],
          "description": "The keyboards attribute is a list of strings that contains the keyboards to be installed on the image. To list available keyboards, run: localectl list-keymaps",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "languages": {
          "default": [
            "en_US.UTF-8"
          ],
          "description": "The languages attribute is a list of strings that contains the languages to be installed on the image. To list available languages, run: localectl list-locales",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "name": {
      "description": "The name attribute is a string that contains the name of the blueprint. It can contain spaces, but they may be converted to dash characters during build. It should be short and descriptive.",
      "type": "string"
    },
    "network": {
      "additionalProperties": false,
      "properties": {
        "firewall": {
          "additionalProperties": false,
          "properties": {
            "services": {
              "description": "Services to enable or disable. The service can be defined via an assigned IANA name, port number or port range.\n\nServices are processed in order, when a service is disabled and then accidentally enabled via a port or a port range, the service will be enabled in the end.\n\nBy default the firewall blocks all access, except for services that enable their ports explicitly such as the sshd.",
              "items": {
                "additionalProperties": false,
                "oneOf": [
                  {
                    "required": [
                      "service"
                    ],
                    "title": "firewall_service"
                  },
                  {
                    "required": [
                      "port"
                    ],
                    "title": "firewall_port"
                  },
                  {
                    "required": [
                      "from",
                      "to"
                    ],
                    "title": "firewall_from_to"
                  }
                ],
                "properties": {
                  "enabled": {
                    "type": [
                      "boolean",
                      "null"
                    ]
                  },
                  "from": {
                    "maximum": 65535,
                    "minimum": 1,
                    "type": "integer"
                  },
                  "port": {
                    "maximum": 65535,
                    "minimum": 1,
                    "type": "integer"
                  },
                  "protocol": {
                    "default": "any",
                    "enum": [
                      "tcp",
                      "udp",
                      "any"
                    ]
                  },
                  "service": {
                    "minLength": 2,
                    "type": "string"
                  },
                  "to": {
                    "maximum": 65535,
                    "minimum": 1,
                    "type": "integer"
                  }
                },
                "type": "object"
              },
              "type": [
                "array",
                "null"
              ]
            }
          },
          "type": "object"
        }
      },
      "type": "object"
    },
    "openscap": {
      "additionalProperties": false,
      "properties": {
        "datastream": {
          "description": "Datastream to use for the scan. The datastream is the path to the SCAP datastream file to use for the scan. If the datastream parameter is not provided, a sensible default based on the selected distro will be chosen.",
          "type": "string"
        },
        "profile_id": {
          "description": "The desired security profile ID.",
          "type": "string"
        },
        "tailoring": {
          "additionalProperties": false,
          "oneOf": [
            {
              "anyOf": [
                {
                  "required": [
                    "selected"
                  ]
                },
                {
                  "required": [
                    "unselected"
                  ]
                },
                {
                  "required": [
                    "selected",
                    "unselected"
                  ]
                }
              ]
            },
            {
              "required": [
                "json_profile_id",
                "json_filepath"
              ]
            }
          ],
          "properties": {
            "json_filepath": {
              "description": "JSON filepath, must be used with json_profile_id and cannot be used with selected and unselected fields.",
              "type": "string"
            },
            "json_profile_id": {
              "description": "JSON profile ID, must be used with json_filepath and cannot be used with selected and unselected fields.",
              "type": "string"
            },
            "selected": {
              "description": "Selected rules, cannot be used with json_profile_id and json_filepath.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "unselected": {
              "description": "Unselected rules, cannot be used with json_profile_id and json_filepath.",
              "items": {
                "type": "string"
              },
              "type": "array"
            }
          },
          "type": "object"
        }
      },
      "required": [
        "profile_id"
      ],
      "type": "object"
    },
    "registration": {
      "additionalProperties": false,
      "properties": {
        "fdo": {
          "additionalProperties": false,
          "oneOf": [
            {
              "required": [
                "diun_pub_key_hash"
              ],
              "title": "fdo_hash"
            },
            {
              "required": [
                "diun_pub_key_root_certs"
              ],
              "title": "fdo_rootcerts"
            }
          ],
          "properties": {
            "di_mfg_string_type_mac_iface": {
              "description": "Optional interface name for the MAC address.",
              "type": "string"
            },
            "diun_pub_key_hash": {
              "description": "FDO server public key hex-encoded hash. Cannot be used together with insecure option or root certs.",
              "type": "string"
            },
            "diun_pub_key_insecure": {
              "default": false,
              "description": "FDO insecure option. When set, both hash or root certs must not be set.",
              "type": "boolean"
            },
            "diun_pub_key_root_certs": {
              "description": "FDO server public key root certificate path. Cannot be used together with insecure option or hash.",
              "type": "string"
            },
            "manufacturing_server_url": {
              "description": "FDO manufacturing server URL.",
              "type": "string"
            }
          },
          "required": [
            "manufacturing_server_url"
          ],
          "type": "object"
        },
        "redhat": {
          "additionalProperties": false,
          "properties": {
            "activation_key": {
              "description": "Subscription manager activation key to use during registration. A list of keys to use to redeem or apply specific subscriptions to the system.",
              "type": "string"
            },
            "connector": {
              "additionalProperties": false,
              "properties": {
                "enabled": {
                  "description": "Enables rhc (Red Hat Connector) during boot.",
                  "type": "boolean"
                }
              },
              "required": [
                "enabled"
              ],
              "type": "object"
            },
            "insights": {
              "additionalProperties": false,
              "properties": {
                "enabled": {
                  "description": "Enables insights client during boot.",
                  "type": "boolean"
                }
              },
              "required": [
                "enabled"
              ],
              "type": "object"
            },
            "organization": {
              "description": "Subscription manager organization name to use during registration.",
              "type": "string"
            },
            "subscription_manager": {
              "additionalProperties": false,
              "properties": {
                "auto_registration": {
                  "default": true,
                  "description": "Enabled auto_registration plugin configuration.",
                  "type": "boolean"
                },
                "enabled": {
                  "default": true,
                  "description": "Enables the subscription-manager DNF plugin.",
                  "type": "boolean"
                },
                "product_plugin_enabled": {
                  "default": true,
                  "description": "Enables the product-id DNF plugin.",
                  "type": "boolean"
                },
                "repository_management": {
                  "default": true,
                  "description": "Enabled repository_management plugin configuration.",
                  "type": "boolean"
                }
              },
              "required": [
                "enabled",
                "product_plugin_enabled",
                "repository_management",
                "auto_registration"
              ],
              "type": "object"
            }
          },
          "type": "object"
        }
      },
      "type": "object"
    },
    "storage": {
      "additionalProperties": false,
      "properties": {
        "minsize": {
          "description": "Minimum size of the storage device. When not set, the image size is acquired from image request.\n\nSize must be formatted as an integer followed by whitespace and then either a decimal unit (B, KB/kB, MB, GB, TB, PB, EB) or binary unit (KiB, MiB, GiB, TiB, PiB, EiB).",
          "pattern": "^\\d+\\s*[BKkMGTPE]i?[BKMGTPE]?$",
          "type": "string"
        },
        "partitions": {
          "description": "Partitions of the following types: plain (default), lvm, or btrfs.",
          "items": {
            "additionalProperties": false,
            "allOf": [
              {
                "anyOf": [
                  {
                    "not": {
                      "properties": {
                        "type": {
                          "enum": [
                            "plain"
                          ]
                        }
                      },
                      "required": [
                        "type"
                      ]
                    }
                  },
                  {
                    "not": {
                      "anyOf": [
                        {
                          "required": [
                            "name"
                          ]
                        },
                        {
                          "required": [
                            "logical_volumes"
                          ]
                        },
                        {
                          "required": [
                            "subvolumes"
                          ]
                        }
                      ]
                    },
                    "required": [
                      "mountpoint",
                      "fs_type",
                      "minsize",
                      "label"
                    ]
                  }
                ]
              },
              {
                "anyOf": [
                  {
                    "not": {
                      "properties": {
                        "type": {
                          "enum": [
                            "lvm"
                          ]
                        }
                      },
                      "required": [
                        "type"
                      ]
                    }
                  },
                  {
                    "not": {
                      "anyOf": [
                        {
                          "required": [
                            "mountpoint"
                          ]
                        },
                        {
                          "required": [
                            "fs_type"
                          ]
                        },
                        {
                          "required": [
                            "label"
                          ]
                        },
                        {
                          "required": [
                            "subvolumes"
                          ]
                        }
                      ]
                    },
                    "required": [
                      "name",
                      "logical_volumes",
                      "minsize"
                    ]
                  }
                ]
              },
              {
                "anyOf": [
                  {
                    "not": {
                      "properties": {
                        "type": {
                          "enum": [
                            "btrfs"
                          ]
                        }
                      },
                      "required": [
                        "type"
                      ]
                    }
                  },
                  {
                    "not": {
                      "anyOf": [
                        {
                          "required": [
                            "name"
                          ]
                        },
                        {
                          "required": [
                            "logical_volumes"
                          ]
                        },
                        {
                          "required": [
                            "mountpoint"
                          ]
                        },
                        {
                          "required": [
                            "fs_type"
                          ]
                        },
                        {
                          "required": [
                            "label"
                          ]
                        }
                      ]
                    },
                    "required": [
                      "subvolumes",
                      "minsize"
                    ]
                  }
                ]
              }
            ],
            "properties": {
              "fs_type": {
                "default": "ext4",
                "description": "File system type: ext4 (default), xfs, swap, or vfat.\n\nRelevant for partition types: plain.",
                "enum": [
                  "ext4",
                  "xfs",
                  "swap",
                  "vfat"
                ]
              },
              "label": {
                "description": "Label of the partition.\n\nRelevant for partition types: plain.",
                "type": "string"
              },
              "logical_volumes": {
                "description": "LVM logical volumes to create within the volume group.\n\nRelevant for partition types: lvm.",
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "fs_type": {
                      "default": "ext4",
                      "description": "File system type: ext4 (default), xfs, swap, or vfat.",
                      "enum": [
                        "ext4",
                        "xfs",
                        "swap",
                        "vfat"
                      ]
                    },
                    "label": {
                      "description": "Label of the logical volume.",
                      "type": "string"
                    },
                    "minsize": {
                      "description": "Minimum size of the logical volume.\n\nSize must be formatted as an integer followed by whitespace and then either a decimal unit (B, KB/kB, MB, GB, TB, PB, EB) or binary unit (KiB, MiB, GiB, TiB, PiB, EiB).",
                      "pattern": "^\\d+\\s*[BKkMGTPE]i?[BKMGTPE]?$",
                      "type": "string"
                    },
                    "mountpoint": {
                      "description": "Mount point of the logical volume. Required except for swap fs_type.",
                      "pattern": "^/",
                      "type": "string"
                    },
                    "name": {
                      "description": "Logical volume name. When not set, will be generated automatically.",
                      "type": "string"
                    }
                  },
                  "type": "object"
                },
                "type": "array"
              },
              "minsize": {
                "description": "Minimum size of the volume.\n\nSize must be formatted as an integer followed by whitespace and then either a decimal unit (B, KB/kB, MB, GB, TB, PB, EB) or binary unit (KiB, MiB, GiB, TiB, PiB, EiB).\n\nRelevant for partition types: plain, lvm, btrfs.",
                "pattern": "^\\d+\\s*[BKkMGTPE]i?[BKMGTPE]?$",
                "type": "string"
              },
              "mountpoint": {
                "description": "Mount point of the partition. Required except for swap fs_type.\n\nRelevant for partition types: plain.",
                "pattern": "^/",
                "type": "string"
              },
              "name": {
                "description": "LVM volume group name. When not set, will be generated automatically.\n\nRelevant for partition types: lvm.",
                "type": "string"
              },
              "subvolumes": {
                "description": "BTRFS subvolumes to create.\n\nRelevant for partition types: btrfs.",
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "mountpoint": {
                      "description": "Mount point of the subvolume. Required. Swap filesystem type is not supported on BTRFS volumes.",
                      "pattern": "^/",
                      "type": "string"
                    },
                    "name": {
                      "description": "Subvolume name, must also define its parent volume.",
                      "type": "string"
                    }
                  },
                  "type": "object"
                },
                "type": "array"
              },
              "type": {
                "default": "plain",
                "description": "Partition type: plain (default), lvm, or btrfs.",
                "enum": [
                  "plain",
                  "lvm",
                  "btrfs"
                ]
              }
            },
            "required": [
              "type"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "type": {
          "default": "gpt",
          "description": "Device partitioning type: gpt (default) or mbr.",
          "enum": [
            "gpt",
            "mbr"
          ]
        }
      },
      "required": [
        "type",
        "minsize",
        "partitions"
      ],
      "type": "object"
    },
    "systemd": {
      "additionalProperties": false,
      "properties": {
        "disabled": {
          "description": "The disabled attribute is a list of strings that contains the systemd units to be disabled.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "enabled": {
          "description": "The enabled attribute is a list of strings that contains the systemd units to be enabled.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        },
        "masked": {
          "description": "The masked attribute is a list of strings that contains the systemd units to be masked.",
          "items": {
            "type": "string"
          },
          "type": [
            "array",
            "null"
          ]
        }
      },
      "type": "object"
    },
    "timedate": {
      "additionalProperties": false,
      "properties": {
        "ntp_servers": {
          "description": "An optional list of strings containing NTP servers to use. If not provided the distribution defaults are used",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "timezone": {
          "default": "UTC",
          "description": "System time zone. Defaults to UTC. To list available time zones run: timedatectl list-timezones",
          "type": "string"
        }
      },
      "required": [
        "timezone"
      ],
      "type": "object"
    }
  },
  "required": [
    "name"
  ],
  "type": "object"
}